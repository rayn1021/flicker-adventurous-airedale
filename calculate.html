<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>計算フォーム</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .form-group {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    label {
      width: 150px; /* ラベルの固定幅 */
      margin-right: 10px;
      text-align: right;
    }
    input[type="text"], select, input[type="number"] {
      flex: 1;
      padding: 8px;
    }
    button {
      padding: 10px 20px;
      cursor: pointer;
    }
    input[readonly] {
      background-color: #f0f0f0;
      cursor: not-allowed;
    }
  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5103998688707267"
     crossorigin="anonymous"></script>
</head>
<body>
  <image src='https://cdn.glitch.global/7d43b8f5-2de2-444f-b615-ec73b3fc0e82/logo_blk_h.png?v=1735034578090' style='width:100%; max-width:800px'></image>

  <h1>計算フォーム</h1>
  <div class="form-group">
    <label for="TYPE">タイプ</label>
    <select id="TYPE">
      <option value="1">ジェネシス</option>
      <option value="2">非ジェネシス</option>
    </select>
  </div>
  <div class="form-group">
    <label for="eff">効率</label>
    <input type="number" id="eff" value="0" placeholder="数値を入力してください">
  </div>
  <div class="form-group">
    <label for="bat">電池</label>
    <input type="number" id="bat" value="0" placeholder="数値を入力してください">
  </div>
  <div class="form-group">
    <label for="strap1">ストラップ1</label>
    <select id="strap1">
      <option value="1">なし</option>
      <option value="2">ブルール(効率+5)</option>
      <option value="3">レッド（効率+3)</option>
      <option value="4">マーレ(バッテリー+5)</option>
      <option value="5">パープル(バッテリー+3)</option>
      <option value="6">リムル(まれに1.2倍)</option>
      <option value="7">シュナ(回復20%減)</option>
    </select>
  </div>
  <div class="form-group">
    <label for="strap2">ストラップ2</label>
    <select id="strap2">
      <option value="1">なし</option>
      <option value="2">ブルール(効率+5)</option>
      <option value="3">レッド（効率+3)</option>
      <option value="4">マーレ(バッテリー+5)</option>
      <option value="5">パープル(バッテリー+3)</option>
      <option value="6">リムル(まれに1.2倍)</option>
      <option value="7">シュナ(回復20%減)</option>
    </select>
  </div>
  <div class="form-group">
    <label for="strap3">ストラップ3</label>
    <select id="strap3">
      <option value="1">なし</option>
      <option value="2">ブルール(効率+5)</option>
      <option value="3">レッド（効率+3)</option>
      <option value="4">マーレ(バッテリー+5)</option>
      <option value="5">パープル(バッテリー+3)</option>
      <option value="6">リムル(まれに1.2倍)</option>
      <option value="7">シュナ(回復20%減)</option>
    </select>
  </div>
  <div class="form-group">
    <label for="rimuru">リムル%</label>
    <input type="number" id="rimuru" value="0" placeholder="数値を入力してください">
  </div>
  <details>
    <summary>レンタル機能はこちら</summary>
      <div class="form-group">
        <label for="rentalDetail">借手割合</label>
        <input type="number" id="rentalDetail" value="0" placeholder="数値を入力してください">
      </div>
      <div class="form-group">
        <label for="LenderSubsc">貸手サブスク加入</label>
        <input type="checkbox" id="LenderSubsc" value="0">
      </div>
      <div class="form-group">
        <label for="renderSubsc">借手サブスク加入</label>
        <input type="checkbox" id="renderSubsc" value="0">
      </div>
  </details>
  <br>
  <div class="form-group">
    <button id="calculateButton">計算する</button>
  </div>
  <h3>計算結果</h3>
  <div class="form-group">
    <label>ベースSTP</label>
    <input type="text" id="outputA1" readonly>
    <label>カテゴリSTP</label>
    <input type="text" id="outputA2" readonly>
  </div>
  <div class="form-group">
    <label>獲得STP</label>
    <input type="text" id="outputA3" readonly>
  </div>
  <div class="form-group">
    <label>バッテリー消費</label>
    <input type="text" id="outputB" readonly>
  </div>
  <div class="form-group">
    <label>回復コスト</label>
    <input type="text" id="outputC" readonly>
  </div>
  <div class="form-group">
    <label id="labelMarginA" style="display:none">運営手数料</label>
    <input type="text" id="marginA" readonly style="display:none">
  </div>
  <div class="form-group">
    <label>獲得期待値</label>
    <input type="text" id="outputD" readonly>
  </div>
  </br>
  <div id="rental" style="display:none">
    <h3>計算結果(レンタル)</h3>
    <div class="form-group">
      <label>獲得STP</label>
      <input type="text" id="outputA3-1" readonly>
    </div>
    <div class="form-group">
      <label>バッテリー消費</label>
      <input type="text" id="outputB-1" readonly>
    </div>
    <div class="form-group">
      <label>回復コスト</label>
      <input type="text" id="outputC-1" readonly>
    </div>
    <div class="form-group">
      <label>運営手数料</label>
      <input type="text" id="marginB" readonly>
    </div>
    <div class="form-group">
      <label>獲得期待値</label>
      <input type="text" id="outputD-1" readonly>
    </div>
  </div>
  </br>

  <h3>更新履歴</h3>
  <textarea id="story" name="story" rows="5" cols="33" style="width: 100%;">
  2024/12/30 レンタル時の計算に手数料を追加
  2024/12/28 レンタル時の計算を追加
  </textarea>
  </br>
  </br>

  <div>
    ※現在β版です。</br>
    端数処理等、計算内容に誤りがある可能性がありますので、お気づきの方は以下までご連絡ください。</br>
    <a href="https://x.com/Rayn73747887" target="_blank">https://x.com/Rayn73747887</a>
  </div>

  <script>
	document.getElementById("calculateButton").addEventListener("click", function() {
		// 入力項目の値を取得
		var inType = document.getElementById("TYPE").value;
		var inEff = parseFloat(document.getElementById("eff").value);
		var inBat = parseFloat(document.getElementById("bat").value);
		var inStrap1 = document.getElementById("strap1").value;
		var inStrap2 = document.getElementById("strap2").value;
		var inStrap3 = document.getElementById("strap3").value;
		var inRimuru = parseFloat(document.getElementById("rimuru").value);
		var inRent = parseFloat(document.getElementById("rentalDetail").value);
		
		// 入力が正しいか確認
		if (isNaN(inEff)) {
			alert("効率に正しい数値を入力してください。");
			return;
		}

		// 入力が正しいか確認
		if (isNaN(inBat)) {
			alert("バッテリーに正しい数値を入力してください。");
			return;
		}

		// 入力が正しいか確認
		if (isNaN(inRimuru)) {
			alert("リムル%に正しい数値を入力してください。");
			return;
		}

		// 入力が正しいか確認
		if (isNaN(inRent)) {
			alert("レンタルに正しい数値を入力してください。");
			return;
		}

		// 入力が正しいか確認
		if (inType == '2' && inRent > 0) {
			alert("非ジェネシスでレンタルすることはできません。");
			return;
		}

		var rimuruFlg = false;
		var shunaFlg = false;

		switch (inStrap1) {
			case "1":
				break;
			case "2":
				inEff += 5;
				break;
			case "3":
				inEff += 3;
				break;
			case "4":
				inBat += 5;
				break;
			case "5":
				inBat += 3;
				break;
			case "6":
				rimuruFlg = true;
				break;
			case "7":
				shunaFlg = true;
				break;
		}

		switch (inStrap2) {
			case "1":
				break;
			case "2":
				inEff += 5;
				break;
			case "3":
				inEff += 3;
				break;
			case "4":
				inBat += 5;
				break;
			case "5":
				inBat += 3;
				break;
			case "6":
				rimuruFlg = true;
				break;
			case "7":
				shunaFlg = true;
				break;
		}

		switch (inStrap3) {
			case "1":
				break;
			case "2":
				inEff += 5;
				break;
			case "3":
				inEff += 3;
				break;
			case "4":
				inBat += 5;
				break;
			case "5":
				inBat += 3;
				break;
			case "6":
				rimuruFlg = true;
				break;
			case "7":
				shunaFlg = true;
				break;
		}
		
		/*
		var magnification = 0.15;
		if(inType == '2'){
			magnification = 0.0925;
		}

		var stp = inEff * magnification;
		if (rimuruFlg == true){
			stp = stp + stp * 0.2 * inRimuru / 100;
		}
		document.getElementById("outputA").value = stp;
		*/
		
		var maxStp = inEff * 0.15;
		var minStp = inEff * 0.15;
		var maxCatStp = 0;
		var minCatStp = 0;
		if (inType == '2') {
			maxStp = inEff * 0.1;
			minStp = inEff * 0.08;
			maxCatStp = inEff * 0.05;
			minCatStp = inEff * 0.01;
		}
		
		if (rimuruFlg == true){
			maxStp = maxStp + maxStp * 0.2 * inRimuru / 100;
			minStp = minStp + minStp * 0.2 * inRimuru / 100;
			maxCatStp = maxCatStp + maxCatStp * 0.2 * inRimuru / 100;
			minCatStp = minCatStp + minCatStp * 0.2 * inRimuru / 100;
		}
		
		maxStp = Math.floor(maxStp * 100) / 100;
		minStp = Math.floor(minStp * 100) / 100;
		maxCatStp = Math.floor(maxCatStp * 100) / 100;
		minCatStp = Math.floor(minCatStp * 100) / 100;
		
		var minTotalStp = Math.floor((minStp + minCatStp) * 100) / 100;
		var maxTotalStp = Math.floor((maxStp + maxCatStp) * 100) / 100;
		
		
		var bat = (inEff - inBat) * 0.04;
		bat = Math.floor(bat * 100) / 100;
		
		var cost = bat;
		if (shunaFlg == true){
			cost = cost * 0.8;
		}
		cost = Math.floor(cost * 100) / 100
    
		if(inRent > 0){
			document.getElementById("rental").style.display="block";
			document.getElementById("marginA").style.display="block";
			document.getElementById("labelMarginA").style.display="block";
			
			var marginA = 0.1;
			var marginB = 0.1;
			
			if (document.getElementById('LenderSubsc').checked) {
				marginA = 0.03;
			} 
			
			if (document.getElementById('renderSubsc').checked) {
				marginB = 0.03;
			} 
			
			//金額の計算
			var wkStpA = Math.floor((maxStp - (maxStp * inRent / 100)) * 100) / 100;	// 貸手ベース
			var marginA = Math.floor(wkStpA * marginA * 100) / 100;	// 貸手手数料
			var wkStpB = Math.floor((maxStp - wkStpA) * 100) / 100;	// 貸手ベース
			var marginB = Math.floor(wkStpB * marginB * 100) / 100;	// 貸手手数料

			document.getElementById("outputA1").value = wkStpA;
			document.getElementById("outputA2").value = 0;
			document.getElementById("outputA3").value = wkStpA;
			document.getElementById("outputB").value = 0;
			document.getElementById("outputC").value = 0;
			document.getElementById("marginA").value = marginA;
			document.getElementById("outputD").value = Math.floor((wkStpA - marginA) * 100) / 100;

			document.getElementById("outputA3-1").value = wkStpB;
			document.getElementById("outputB-1").value = Math.floor(bat * 100) / 100;
			document.getElementById("outputC-1").value = Math.floor(cost * 100) / 100;
			document.getElementById("marginB").value = marginB;
			document.getElementById("outputD-1").value = Math.floor((wkStpB - cost - marginB) * 100) / 100;
		} else {
			document.getElementById("rental").style.display="none";
			document.getElementById("marginA").style.display="none";
			document.getElementById("labelMarginA").style.display="none";

			if (inType == '1') {
				document.getElementById("outputA1").value = Math.floor(maxStp * 100) / 100;
				document.getElementById("outputA2").value = Math.floor(maxCatStp * 100) / 100;
				document.getElementById("outputA3").value = Math.floor(maxTotalStp * 100) / 100;
			} else {
				document.getElementById("outputA1").value = minStp + "～" + maxStp;
				document.getElementById("outputA2").value = minCatStp + "～" + maxCatStp;
				document.getElementById("outputA3").value = minTotalStp + "～" + maxTotalStp;
			}

			document.getElementById("outputB").value = bat;
			document.getElementById("outputC").value = cost;
			document.getElementById("outputD").value = Math.floor((maxTotalStp - cost) * 100) / 100;
		}
    });
  </script>
</body>
</html>
